- name: ðŸ“¦ Initialize and Relocate Dependencies (Using cp -r)
        run: |
          echo "--- 1. Initializing West Workspace ---"
          west init -l config || { echo "FATAL: west init failed."; exit 1; }
          west update || { echo "FATAL: west update failed. Check access/manifest."; exit 1; }
          
          # -------------------------------------------------------------
          # System Engineer Fix: Force ZMK/Zephyr dependencies into the 
          # expected $GITHUB_WORKSPACE/zmk path using 'cp -r'.
          # -------------------------------------------------------------
          
          echo "--- 2. Locating and Moving Dependencies (rsync fix) ---"
          
          # Check for the main 'zephyr' submodule, which contains the required files.
          ZEPHYR_DIR="$GITHUB_WORKSPACE/zephyr"
          ZMK_DIR="$GITHUB_WORKSPACE/zmk"

          if [ ! -d "$ZEPHYR_DIR" ]; then
             echo "FATAL: The 'zephyr' directory was not created by west update."
             exit 1
          fi

          echo "TRACE: Found Zephyr dependencies at: $ZEPHYR_DIR"

          # Create the expected target directory
          mkdir -p "$ZMK_DIR/zephyr"

          # Copy the entire Zephyr folder structure into the expected zmk/ directory.
          # This creates the target: $GITHUB_WORKSPACE/zmk/zephyr/zephyr-env.sh
          echo "TRACE: Copying $ZEPHYR_DIR to $ZMK_DIR/zephyr using cp -r"
          cp -r "$ZEPHYR_DIR/"* "$ZMK_DIR/zephyr" || { echo "FATAL: Failed to copy ZMK files using cp -r."; exit 1; }
          
          # Trace: Confirm the copy operation
          echo "TRACE: Confirming new path contents ($ZMK_DIR/zephyr/)"
          ls -la "$ZMK_DIR/zephyr/zephyr-env.sh" || { echo "FATAL: Relocation failed. Target file is missing."; exit 1; }
          
          echo "Relocation successful. ZMK environment is ready."
